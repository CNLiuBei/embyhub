# Emby用户管理系统 - 配置说明

## 数据库配置

### PostgreSQL 配置信息

```yaml
数据库名: embyhub
用户名: embyhub
密码: embyhub123
端口: 5432
```

### 初始化数据库

```bash
# 连接到数据库
psql -U embyhub -d embyhub

# 执行初始化脚本
psql -U embyhub -d embyhub -f database/init_schema.sql
psql -U embyhub -d embyhub -f database/init_data.sql
```

---

## 默认管理员账号

```yaml
用户名: admin
密码: Liubei00
```

**⚠️ 安全提醒：请在首次登录后立即修改默认密码！**

---

## 技术栈与依赖版本

### 前端依赖

| 技术 | 版本 | 用途 |
|------|------|------|
| React | 18+ | 核心框架 |
| TypeScript | 5.0+ | 强类型支持 |
| Ant Design | 5.x | UI 组件库 |
| Redux Toolkit | Latest | 全局状态管理 |
| React Router | 6.x | 路由管理 |
| Axios | Latest | HTTP 请求 |
| Chart.js | Latest | 数据可视化 |
| Vite | Latest | 构建工具 |

### 后端依赖

| 技术 | 版本 | 用途 |
|------|------|------|
| Go | 1.21+ | 编程语言 |
| Gin | 1.9+ | Web 框架 |
| GORM | 2.x | ORM 框架 |
| go-redis | 9.x | Redis 客户端 |
| golang-jwt/jwt | v5 | JWT 认证 |
| go-playground/validator | Latest | 参数校验 |
| zap | Latest | 日志库 |
| bcrypt | Latest | 密码加密 |

### 基础设施

| 技术 | 版本 | 用途 |
|------|------|------|
| PostgreSQL | 14+ | 主数据库 |
| Redis | 7.0+ | 缓存 |
| Docker | Latest | 容器化 |
| Docker Compose | Latest | 容器编排 |

---

## 后端配置文件

### config.yaml 配置示例

```yaml
server:
  port: 8080
  mode: debug # debug, release, test

database:
  host: localhost
  port: 5432
  user: embyhub
  password: embyhub123
  dbname: embyhub
  sslmode: disable
  maxIdleConns: 10
  maxOpenConns: 100
  connMaxLifetime: 3600

redis:
  host: localhost
  port: 6379
  password: ""
  db: 0
  poolSize: 10
  minIdleConns: 5

jwt:
  secret: emby-ums-secret-key-change-in-production
  expireHours: 24
  issuer: embyhub

emby:
  serverUrl: http://localhost:8096
  apiKey: ""
  syncInterval: 3600
  timeout: 30

log:
  level: info
  filename: logs/app.log
  maxSize: 100
  maxBackups: 10
  maxAge: 30
  compress: true

cors:
  allowOrigins:
    - http://localhost:3000
    - http://localhost:5173
  allowMethods:
    - GET
    - POST
    - PUT
    - DELETE
    - OPTIONS
  allowHeaders:
    - Content-Type
    - Authorization
  exposeHeaders:
    - Content-Length
  allowCredentials: true
  maxAge: 43200
```

---

## 环境变量配置

可通过环境变量覆盖配置文件：

```bash
# 数据库配置
DB_HOST=localhost
DB_PORT=5432
DB_USER=embyhub
DB_PASSWORD=embyhub123
DB_NAME=embyhub

# Redis配置
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# JWT配置
JWT_SECRET=emby-ums-secret-key-change-in-production
JWT_EXPIRE_HOURS=24

# Emby配置
EMBY_SERVER_URL=http://localhost:8096
EMBY_API_KEY=

# 服务器配置
SERVER_PORT=8080
SERVER_MODE=release

# 日志配置
LOG_LEVEL=info
```

---

## 快速启动

### 方式 1: Docker Compose（推荐）

```bash
# 启动所有服务
docker-compose up -d

# 查看日志
docker-compose logs -f

# 停止服务
docker-compose down
```

### 方式 2: 手动启动

```bash
# 1. 启动 PostgreSQL（假设已配置）
# 确保 PostgreSQL 运行在 localhost:5432

# 2. 启动 Redis
docker run -d -p 6379:6379 redis:7-alpine

# 3. 初始化数据库
psql -U embyhub -d embyhub -f database/init_schema.sql
psql -U embyhub -d embyhub -f database/init_data.sql

# 4. 启动后端
cd backend
go mod download
go run cmd/main.go

# 5. 启动前端
cd frontend
npm install
npm run dev
```

---

## 服务端口

| 服务 | 端口 | 访问地址 |
|------|------|----------|
| 前端 | 3000 | http://localhost:3000 |
| 后端 API | 8080 | http://localhost:8080 |
| PostgreSQL | 5432 | localhost:5432 |
| Redis | 6379 | localhost:6379 |

---

## 密码加密说明

系统使用 bcrypt 算法加密密码，默认 cost 为 10。

生成新密码哈希：

```bash
cd backend
go run tools/gen_password.go <your-password>
```

示例输出：
```
Password: Liubei00
Bcrypt Hash: $2a$10$NIDdLWXZi/0cv3yuQcoyjulmEOqynzjUQgsjtLxrWypD33wGClaX6
```

---

## 常见问题

### 数据库连接失败

1. 检查 PostgreSQL 是否运行
2. 确认用户名密码正确
3. 检查防火墙设置

### Redis 连接失败

1. 检查 Redis 是否运行
2. 确认端口 6379 未被占用

### Emby 同步失败

1. 检查 Emby 服务器地址是否正确
2. 验证 API Key 是否有效
3. 确认网络连通性

---

## 安全建议

1. **修改默认密码**：首次登录后立即修改 admin 密码
2. **更换 JWT Secret**：在生产环境中使用强随机字符串
3. **使用 HTTPS**：生产环境建议配置 SSL 证书
4. **限制数据库访问**：仅允许后端服务器访问数据库
5. **定期备份**：定期备份 PostgreSQL 数据库
